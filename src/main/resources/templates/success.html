<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: template (~{::head}, ~{::body}, ~{::scripts})}">
<head>
    <title>–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞</title>
</head>
<body>
    <div class="container mt-5">
        <!-- –§–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã -->
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h1>–í—ã —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—Ç–∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É üéâ</h1>
                        <p id="next-billing-date">–ò–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç—ã —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è...</p>
                        <p>–ß—Ç–æ–±—ã –æ—Ç–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

<th:block th:fragment="scripts">
    <script th:inline="javascript">
        function checkSubscription() {
            fetch('/api/subscription')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        setTimeout(checkSubscription, 1000); // –ü–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                    }
                })
                .then(data => {
                    if (data) {
                        var date = new Date(data.subscriptionDate);
                        date.setMonth(date.getMonth() + 1);
                        document.getElementById('next-billing-date').innerText = '–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è: ' + date.toLocaleDateString('ru-RU');
                    }
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏', error));
        }

        checkSubscription();

        Telegram.WebApp.MainButton.text = "–ö —Å–æ–æ–±—â–µ—Å—Ç–≤—É";
        Telegram.WebApp.onEvent('mainButtonClicked', function () {
            Telegram.WebApp.openTelegramLink('https://t.me/+oSjq-iHU_k5iMGQy');
        });
        Telegram.WebApp.MainButton.show();

        Telegram.WebApp.SecondaryButton.text = "–ü—Ä–æ—Ñ–∏–ª—å";
        Telegram.WebApp.SecondaryButton.position = "right";
        Telegram.WebApp.onEvent('secondaryButtonClicked', function () {
            window.location.href = "/profile"
        });
        Telegram.WebApp.SecondaryButton.show();
    </script>
</th:block>
</body>
</html>