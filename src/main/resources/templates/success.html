<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: template (~{::head}, ~{::body}, ~{::scripts})}">
<head>
    <title>–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞</title>
</head>
<body>
<div class="container mt-4">
    <!-- –§–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã -->
    <div class="row justify-content-center">
        <div class="col-md-6">
            <h1>–¢—ã —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—Ç–∏–ª–∞ –ø–æ–¥–ø–∏—Å–∫—É üéâ</h1>
            <div class="card">
                <div class="card-body">
                    <p>–°–ø–∞—Å–∏–±–æ –∑–∞ –¥–æ–≤–µ—Ä–∏–µ –∏ —Ä–∞–¥–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–µ–±—è –≤ –º–æ–µ–º —Å–æ–æ–±—â–µ—Å—Ç–≤–µ ‚ò∫Ô∏è</p>
                    <div th:if="${firstRun}">
                        <p>–ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Ç–≤–æ–µ –ø—Ä–µ–±—ã–≤–∞–Ω–∏–µ –µ—â—ë –±–æ–ª–µ–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–º –∏ –ø–æ–ª–µ–∑–Ω—ã–º, –ø—Ä–µ–¥–ª–∞–≥–∞—é –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–≤–æ–π
                            –ø—Ä–æ—Ñ–∏–ª—å. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–º –ª—É—á—à–µ —É–∑–Ω–∞—Ç—å –≤–∞—Å –∏ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏
                            –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
                        <p>–ñ–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ üëá</p>
                    </div>
                    <!--<p id="next-billing-date">–ò–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç—ã —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è...</p>
                    <p>–ß—Ç–æ–±—ã –æ—Ç–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å</p>-->
                </div>
            </div>
        </div>
        <div class="col-md-6 mt-3" th:if="${!firstRun}">
            <div class="alert alert-info" role="alert">
                <h6 class="alert-heading">–ù—É–∂–µ–Ω –ø–æ–≤—Ç–æ—Ä –æ–±—É—á–µ–Ω–∏—è?</h6>
                <small>–ñ–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–Ω–æ–≤–∞</small>
                <hr>
                <p class="mb-0">
                    <button class="btn btn-sm btn-outline-primary"
                            onclick="window.location.href = '/onboarding'">
                        –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                    </button>
                </p>
            </div>
        </div>
    </div>
</div>
</body>

<th:block th:fragment="scripts">
    <script th:inline="javascript">
        function checkSubscription() {
            fetch('/api/subscription/current')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        setTimeout(checkSubscription, 1000); // –ü–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                    }
                })
                .then(data => {
                    if (data) {
                        var date = new Date(data.subscriptionDate);
                        date.setMonth(date.getMonth() + 1);
                        document.getElementById('next-billing-date').innerText = '–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è: ' + date.toLocaleDateString('ru-RU');
                    }
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏', error));
        }

        checkSubscription();
    </script>
    <script th:inline="javascript" th:if="${firstRun}">
        Telegram.WebApp.isClosingConfirmationEnabled = true;
        Telegram.WebApp.MainButton.text = "–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å";
        Telegram.WebApp.MainButton.hasShineEffect = true;
        Telegram.WebApp.onEvent('mainButtonClicked', function () {
            window.location.href = "/profile";
        });
        Telegram.WebApp.MainButton.show();
    </script>

    <script th:inline="javascript" th:if="${!firstRun}">
        Telegram.WebApp.isClosingConfirmationEnabled = false;
        Telegram.WebApp.MainButton.text = "–ö —Å–æ–æ–±—â–µ—Å—Ç–≤—É";
        Telegram.WebApp.onEvent('mainButtonClicked', function () {
            Telegram.WebApp.openTelegramLink([[${@environment.getProperty('app.telegram.society-link')}]]);
        });
        Telegram.WebApp.MainButton.show();

        Telegram.WebApp.SecondaryButton.text = "–ü—Ä–æ—Ñ–∏–ª—å";
        Telegram.WebApp.SecondaryButton.position = "right";
        Telegram.WebApp.onEvent('secondaryButtonClicked', function () {
            window.location.href = "/profile"
        });
        Telegram.WebApp.SecondaryButton.show();
    </script>
</th:block>
</html>